<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/staking/DittoStaking.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">contracts/staking/</a> DittoStaking.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/125</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/46</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/21</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/126</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
&nbsp;
pragma solidity &gt;=0.5.17 &lt;0.8.0;
&nbsp;
import "../mocks/IERC20.sol";
import "../mocks/Ownable.sol";
import "../lib/SafeMath.sol";
import "./IStaking.sol";
import "./TokenPool.sol";
&nbsp;
&nbsp;
/**
 * @title Multi Staking
 * @dev A smart-contract based mechanism to distribute tokens over time, based on the Ampleforth Geyser.
 *
 *      Distribution tokens are added to a locked pool in the contract and become unlocked over time
 *      according to a once-configurable unlock schedule. Once unlocked, they are available to be
 *      claimed by users.
 *
 *      A user may deposit tokens to accrue ownership share over the unlocked pool. This owner share
 *      is a function of the number of tokens deposited as well as the length of time deposited.
 *      Specifically, a user's share of the currently-unlocked pool equals their "deposit-seconds"
 *      divided by the global "deposit-seconds". This aligns the new token distribution with long
 *      term supporters of the project, addressing one of the major drawbacks of simple airdrops.
 *
 *      More background and motivation available at:
 *      https://github.com/ampleforth/RFCs/blob/master/RFCs/rfc-1.md
 */
contract DittoStaking is IStaking, Ownable {
    using SafeMath for uint256;
&nbsp;
    event Staked(address indexed user, uint256 amount, uint256 total, bytes data);
    event Unstaked(address indexed user, uint256 amount, uint256 total, bytes data);
    event TokensClaimed(address indexed user, uint256 amount);
    event TokensLocked(uint256 amount, uint256 durationSec, uint256 total);
    // amount: Unlocked tokens, total: Total locked tokens
    event TokensUnlocked(uint256 amount, uint256 total);
&nbsp;
    TokenPool public _stakingPool;
    TokenPool public _unlockedPool;
    TokenPool public _lockedPool;
&nbsp;
    //
    // Time-bonus params
    //
    uint256 public constant BONUS_DECIMALS = 2;
    uint256 public startBonus = 0;
    uint256 public bonusPeriodSec = 0;
&nbsp;
    //
    // Global accounting state
    //
    uint256 public totalLockedShares = 0;
    uint256 public totalStakingShares = 0;
    uint256 private _totalStakingShareSeconds = 0;
    uint256 private _lastAccountingTimestampSec = now;
    uint256 private _maxUnlockSchedules = 0;
    uint256 private _initialSharesPerToken = 0;
&nbsp;
    //
    // User accounting state
    //
    // Represents a single stake for a user. A user may have multiple.
    struct Stake {
        uint256 stakingShares;
        uint256 timestampSec;
    }
&nbsp;
    // Caches aggregated values from the User-&gt;Stake[] map to save computation.
    // If lastAccountingTimestampSec is 0, there's no entry for that user.
    struct UserTotals {
        uint256 stakingShares;
        uint256 stakingShareSeconds;
        uint256 lastAccountingTimestampSec;
    }
&nbsp;
    // Aggregated staking values per user
    mapping(address =&gt; UserTotals) private _userTotals;
&nbsp;
    // The collection of stakes for each user. Ordered by timestamp, earliest to latest.
    mapping(address =&gt; Stake[]) private _userStakes;
&nbsp;
    //
    // Locked/Unlocked Accounting state
    //
    struct UnlockSchedule {
        uint256 initialLockedShares;
        uint256 unlockedShares;
        uint256 lastUnlockTimestampSec;
        uint256 endAtSec;
        uint256 durationSec;
    }
&nbsp;
    UnlockSchedule[] public unlockSchedules;
&nbsp;
    /**
     * @param stakingToken The token users deposit as stake.
     * @param distributionToken The token users receive as they unstake.
     * @param maxUnlockSchedules Max number of unlock stages, to guard against hitting gas limit.
     * @param startBonus_ Starting time bonus, BONUS_DECIMALS fixed point.
     *                    e.g. 25% means user gets 25% of max distribution tokens.
     * @param bonusPeriodSec_ Length of time for bonus to increase linearly to max.
     * @param initialSharesPerToken Number of shares to mint per staking token on first stake.
     */
<span class="fstat-no" title="function not covered" >    constructor(IERC20 stakingToken, IERC20 distributionToken, uint256 maxUnlockSchedules,</span>
                uint256 startBonus_, uint256 bonusPeriodSec_, uint256 initialSharesPerToken) public {
        // The start bonus must be some fraction of the max. (i.e. &lt;= 100%)
<span class="cstat-no" title="statement not covered" >        require(startBonus_ &lt;= 10**BONUS_DECIMALS, 'DittoStaking: start bonus too high')</span>;
        // If no period is desired, instead set startBonus = 100%
        // and bonusPeriod to a small value like 1sec.
<span class="cstat-no" title="statement not covered" >        require(bonusPeriodSec_ != 0, 'DittoStaking: bonus period is zero')</span>;
<span class="cstat-no" title="statement not covered" >        require(initialSharesPerToken &gt; 0, 'DittoStaking: initialSharesPerToken is zero')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        _stakingPool = new TokenPool(stakingToken)</span>;
<span class="cstat-no" title="statement not covered" >        _unlockedPool = new TokenPool(distributionToken)</span>;
<span class="cstat-no" title="statement not covered" >        _lockedPool = new TokenPool(distributionToken)</span>;
<span class="cstat-no" title="statement not covered" >        startBonus = startBonus_</span>;
<span class="cstat-no" title="statement not covered" >        bonusPeriodSec = bonusPeriodSec_</span>;
<span class="cstat-no" title="statement not covered" >        _maxUnlockSchedules = maxUnlockSchedules</span>;
<span class="cstat-no" title="statement not covered" >        _initialSharesPerToken = initialSharesPerToken</span>;
    }
&nbsp;
    /**
     * @return The token users deposit as stake.
     */
<span class="fstat-no" title="function not covered" >    function getStakingToken() public view returns (IERC20) {</span>
<span class="cstat-no" title="statement not covered" >        return _stakingPool.token();</span>
    }
&nbsp;
    /**
     * @return The token users receive as they unstake.
     */
<span class="fstat-no" title="function not covered" >    function getDistributionToken() public view returns (IERC20) {</span>
<span class="cstat-no" title="statement not covered" >        assert(_unlockedPool.token() == _lockedPool.token())</span>;
<span class="cstat-no" title="statement not covered" >        return _unlockedPool.token();</span>
    }
&nbsp;
    /**
     * @dev Transfers amount of deposit tokens from the user.
     * @param amount Number of deposit tokens to stake.
     * @param data Not used.
     */
<span class="fstat-no" title="function not covered" >    function stake(uint256 amount, bytes calldata data) external {</span>
<span class="cstat-no" title="statement not covered" >        _stakeFor(msg.sender, msg.sender, amount)</span>;
    }
&nbsp;
    /**
     * @dev Transfers amount of deposit tokens from the caller on behalf of user.
     * @param user User address who gains credit for this stake operation.
     * @param amount Number of deposit tokens to stake.
     * @param data Not used.
     */
<span class="fstat-no" title="function not covered" >    function stakeFor(address user, uint256 amount, bytes calldata data) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        _stakeFor(msg.sender, user, amount)</span>;
    }
&nbsp;
    /**
     * @dev Private implementation of staking methods.
     * @param staker User address who deposits tokens to stake.
     * @param beneficiary User address who gains credit for this stake operation.
     * @param amount Number of deposit tokens to stake.
     */
<span class="fstat-no" title="function not covered" >    function _stakeFor(address staker, address beneficiary, uint256 amount) private {</span>
<span class="cstat-no" title="statement not covered" >        require(amount &gt; 0, 'DittoStaking: stake amount is zero')</span>;
<span class="cstat-no" title="statement not covered" >        require(beneficiary != address(0), 'DittoStaking: beneficiary is zero address')</span>;
<span class="cstat-no" title="statement not covered" >        require(totalStakingShares == 0 || totalStaked() &gt; 0,</span>
                'DittoStaking: Invalid state. Staking shares exist, but no staking tokens do');
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 mintedStakingShares = (totalStakingShares &gt; 0)</span>
            ? totalStakingShares.mul(amount).div(totalStaked())
            : amount.mul(_initialSharesPerToken);
<span class="cstat-no" title="statement not covered" >        require(mintedStakingShares &gt; 0, 'DittoStaking: Stake amount is too small')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        updateAccounting()</span>;
&nbsp;
        // 1. User Accounting
<span class="cstat-no" title="statement not covered" >        UserTotals storage totals = _userTotals[beneficiary];</span>
<span class="cstat-no" title="statement not covered" >        totals.stakingShares = totals.stakingShares.add(mintedStakingShares)</span>;
<span class="cstat-no" title="statement not covered" >        totals.lastAccountingTimestampSec = now</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        Stake memory newStake = Stake(mintedStakingShares, now);</span>
<span class="cstat-no" title="statement not covered" >        _userStakes[beneficiary].push(newStake)</span>;
&nbsp;
        // 2. Global Accounting
<span class="cstat-no" title="statement not covered" >        totalStakingShares = totalStakingShares.add(mintedStakingShares)</span>;
        // Already set in updateAccounting()
        // _lastAccountingTimestampSec = now;
&nbsp;
        // interactions
<span class="cstat-no" title="statement not covered" >        require(_stakingPool.token().transferFrom(staker, address(_stakingPool), amount),</span>
            'DittoStaking: transfer into staking pool failed');
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit Staked(beneficiary, amount, totalStakedFor(beneficiary), "");</span>
    }
&nbsp;
    /**
     * @dev Unstakes a certain amount of previously deposited tokens. User also receives their
     * alotted number of distribution tokens.
     * @param amount Number of deposit tokens to unstake / withdraw.
     * @param data Not used.
     */
<span class="fstat-no" title="function not covered" >    function unstake(uint256 amount, bytes calldata data) external {</span>
<span class="cstat-no" title="statement not covered" >        _unstake(amount)</span>;
    }
&nbsp;
    /**
     * @param amount Number of deposit tokens to unstake / withdraw.
     * @return The total number of distribution tokens that would be rewarded.
     */
<span class="fstat-no" title="function not covered" >    function unstakeQuery(uint256 amount) public returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return _unstake(amount);</span>
    }
&nbsp;
    /**
     * @dev Unstakes a certain amount of previously deposited tokens. User also receives their
     * alotted number of distribution tokens.
     * @param amount Number of deposit tokens to unstake / withdraw.
     * @return The total number of distribution tokens rewarded.
     */
<span class="fstat-no" title="function not covered" >    function _unstake(uint256 amount) private returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        updateAccounting()</span>;
&nbsp;
        // checks
<span class="cstat-no" title="statement not covered" >        require(amount &gt; 0, 'DittoStaking: unstake amount is zero')</span>;
<span class="cstat-no" title="statement not covered" >        require(totalStakedFor(msg.sender) &gt;= amount,</span>
            'DittoStaking: unstake amount is greater than total user stakes');
<span class="cstat-no" title="statement not covered" >        uint256 stakingSharesToBurn = totalStakingShares.mul(amount).div(totalStaked());</span>
<span class="cstat-no" title="statement not covered" >        require(stakingSharesToBurn &gt; 0, 'DittoStaking: Unable to unstake amount this small')</span>;
&nbsp;
        // 1. User Accounting
<span class="cstat-no" title="statement not covered" >        UserTotals storage totals = _userTotals[msg.sender];</span>
<span class="cstat-no" title="statement not covered" >        Stake[] storage accountStakes = _userStakes[msg.sender];</span>
&nbsp;
        // Redeem from most recent stake and go backwards in time.
<span class="cstat-no" title="statement not covered" >        uint256 stakingShareSecondsToBurn = 0;</span>
<span class="cstat-no" title="statement not covered" >        uint256 sharesLeftToBurn = stakingSharesToBurn;</span>
<span class="cstat-no" title="statement not covered" >        uint256 rewardAmount = 0;</span>
<span class="cstat-no" title="statement not covered" >        while (sharesLeftToBurn &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >            Stake storage lastStake = accountStakes[accountStakes.length - 1];</span>
<span class="cstat-no" title="statement not covered" >            uint256 stakeTimeSec = now.sub(lastStake.timestampSec);</span>
<span class="cstat-no" title="statement not covered" >            uint256 newStakingShareSecondsToBurn = 0;</span>
<span class="cstat-no" title="statement not covered" >            if (lastStake.stakingShares &lt;= sharesLeftToBurn) {</span>
                // fully redeem a past stake
<span class="cstat-no" title="statement not covered" >                newStakingShareSecondsToBurn = lastStake.stakingShares.mul(stakeTimeSec)</span>;
<span class="cstat-no" title="statement not covered" >                rewardAmount = computeNewReward(rewardAmount, newStakingShareSecondsToBurn, stakeTimeSec)</span>;
<span class="cstat-no" title="statement not covered" >                stakingShareSecondsToBurn = stakingShareSecondsToBurn.add(newStakingShareSecondsToBurn)</span>;
<span class="cstat-no" title="statement not covered" >                sharesLeftToBurn = sharesLeftToBurn.sub(lastStake.stakingShares)</span>;
                accountStakes.length--;
            } else {
                // partially redeem a past stake
<span class="cstat-no" title="statement not covered" >                newStakingShareSecondsToBurn = sharesLeftToBurn.mul(stakeTimeSec)</span>;
<span class="cstat-no" title="statement not covered" >                rewardAmount = computeNewReward(rewardAmount, newStakingShareSecondsToBurn, stakeTimeSec)</span>;
<span class="cstat-no" title="statement not covered" >                stakingShareSecondsToBurn = stakingShareSecondsToBurn.add(newStakingShareSecondsToBurn)</span>;
<span class="cstat-no" title="statement not covered" >                lastStake.stakingShares = lastStake.stakingShares.sub(sharesLeftToBurn)</span>;
<span class="cstat-no" title="statement not covered" >                sharesLeftToBurn = 0</span>;
            }
        }
<span class="cstat-no" title="statement not covered" >        totals.stakingShareSeconds = totals.stakingShareSeconds.sub(stakingShareSecondsToBurn)</span>;
<span class="cstat-no" title="statement not covered" >        totals.stakingShares = totals.stakingShares.sub(stakingSharesToBurn)</span>;
        // Already set in updateAccounting
        // totals.lastAccountingTimestampSec = now;
&nbsp;
        // 2. Global Accounting
<span class="cstat-no" title="statement not covered" >        _totalStakingShareSeconds = _totalStakingShareSeconds.sub(stakingShareSecondsToBurn)</span>;
<span class="cstat-no" title="statement not covered" >        totalStakingShares = totalStakingShares.sub(stakingSharesToBurn)</span>;
        // Already set in updateAccounting
        // _lastAccountingTimestampSec = now;
&nbsp;
        // interactions
<span class="cstat-no" title="statement not covered" >        require(_stakingPool.transfer(msg.sender, amount),</span>
            'DittoStaking: transfer out of staking pool failed');
<span class="cstat-no" title="statement not covered" >        require(_unlockedPool.transfer(msg.sender, rewardAmount),</span>
            'DittoStaking: transfer out of unlocked pool failed');
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit Unstaked(msg.sender, amount, totalStakedFor(msg.sender), "");</span>
<span class="cstat-no" title="statement not covered" >        emit TokensClaimed(msg.sender, rewardAmount);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        require(totalStakingShares == 0 || totalStaked() &gt; 0,</span>
                "DittoStaking: Error unstaking. Staking shares exist, but no staking tokens do");
<span class="cstat-no" title="statement not covered" >        return rewardAmount;</span>
    }
&nbsp;
    /**
     * @dev Applies an additional time-bonus to a distribution amount. This is necessary to
     *      encourage long-term deposits instead of constant unstake/restakes.
     *      The bonus-multiplier is the result of a linear function that starts at startBonus and
     *      ends at 100% over bonusPeriodSec, then stays at 100% thereafter.
     * @param currentRewardTokens The current number of distribution tokens already alotted for this
     *                            unstake op. Any bonuses are already applied.
     * @param stakingShareSeconds The stakingShare-seconds that are being burned for new
     *                            distribution tokens.
     * @param stakeTimeSec Length of time for which the tokens were staked. Needed to calculate
     *                     the time-bonus.
     * @return Updated amount of distribution tokens to award, with any bonus included on the
     *         newly added tokens.
     */
<span class="fstat-no" title="function not covered" >    function computeNewReward(uint256 currentRewardTokens,</span>
                                uint256 stakingShareSeconds,
                                uint256 stakeTimeSec) private view returns (uint256) {
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 newRewardTokens =</span>
            totalUnlocked()
            .mul(stakingShareSeconds)
            .div(_totalStakingShareSeconds);
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (stakeTimeSec &gt;= bonusPeriodSec) {</span>
<span class="cstat-no" title="statement not covered" >            return currentRewardTokens.add(newRewardTokens);</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 oneHundredPct = 10**BONUS_DECIMALS;</span>
<span class="cstat-no" title="statement not covered" >        uint256 bonusedReward =</span>
            startBonus
            .add(oneHundredPct.sub(startBonus).mul(stakeTimeSec).div(bonusPeriodSec))
            .mul(newRewardTokens)
            .div(oneHundredPct);
<span class="cstat-no" title="statement not covered" >        return currentRewardTokens.add(bonusedReward);</span>
    }
&nbsp;
    /**
     * @param addr The user to look up staking information for.
     * @return The number of staking tokens deposited for addr.
     */
<span class="fstat-no" title="function not covered" >    function totalStakedFor(address addr) public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return totalStakingShares &gt; 0 ?</span>
            totalStaked().mul(_userTotals[addr].stakingShares).div(totalStakingShares) : 0;
    }
&nbsp;
    /**
     * @return The total number of deposit tokens staked globally, by all users.
     */
<span class="fstat-no" title="function not covered" >    function totalStaked() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return _stakingPool.balance();</span>
    }
&nbsp;
    /**
     * @dev Note that this application has a staking token as well as a distribution token, which
     * may be different. This function is required by EIP-900.
     * @return The deposit token used for staking.
     */
<span class="fstat-no" title="function not covered" >    function token() external view returns (address) {</span>
<span class="cstat-no" title="statement not covered" >        return address(getStakingToken());</span>
    }
&nbsp;
    /**
     * @dev A globally callable function to update the accounting state of the system.
     *      Global state and state for the caller are updated.
     * @return [0] balance of the locked pool
     * @return [1] balance of the unlocked pool
     * @return [2] caller's staking share seconds
     * @return [3] global staking share seconds
     * @return [4] Rewards caller has accumulated, optimistically assumes max time-bonus.
     * @return [5] block timestamp
     */
<span class="fstat-no" title="function not covered" >    function updateAccounting() public returns (</span>
        uint256, uint256, uint256, uint256, uint256, uint256) {
&nbsp;
<span class="cstat-no" title="statement not covered" >        unlockTokens()</span>;
&nbsp;
        // Global accounting
<span class="cstat-no" title="statement not covered" >        uint256 newStakingShareSeconds =</span>
            now
            .sub(_lastAccountingTimestampSec)
            .mul(totalStakingShares);
<span class="cstat-no" title="statement not covered" >        _totalStakingShareSeconds = _totalStakingShareSeconds.add(newStakingShareSeconds)</span>;
<span class="cstat-no" title="statement not covered" >        _lastAccountingTimestampSec = now</span>;
&nbsp;
        // User Accounting
<span class="cstat-no" title="statement not covered" >        UserTotals storage totals = _userTotals[msg.sender];</span>
<span class="cstat-no" title="statement not covered" >        uint256 newUserStakingShareSeconds =</span>
            now
            .sub(totals.lastAccountingTimestampSec)
            .mul(totals.stakingShares);
<span class="cstat-no" title="statement not covered" >        totals.stakingShareSeconds =</span>
            totals.stakingShareSeconds
            .add(newUserStakingShareSeconds);
<span class="cstat-no" title="statement not covered" >        totals.lastAccountingTimestampSec = now</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 totalUserRewards = (_totalStakingShareSeconds &gt; 0)</span>
            ? totalUnlocked().mul(totals.stakingShareSeconds).div(_totalStakingShareSeconds)
            : 0;
&nbsp;
<span class="cstat-no" title="statement not covered" >        return (</span>
            totalLocked(),
            totalUnlocked(),
            totals.stakingShareSeconds,
            _totalStakingShareSeconds,
            totalUserRewards,
            now
        );
    }
&nbsp;
    /**
     * @return Total number of locked distribution tokens.
     */
<span class="fstat-no" title="function not covered" >    function totalLocked() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return _lockedPool.balance();</span>
    }
&nbsp;
    /**
     * @return Total number of unlocked distribution tokens.
     */
<span class="fstat-no" title="function not covered" >    function totalUnlocked() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return _unlockedPool.balance();</span>
    }
&nbsp;
    /**
     * @return Number of unlock schedules.
     */
<span class="fstat-no" title="function not covered" >    function unlockScheduleCount() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return unlockSchedules.length;</span>
    }
&nbsp;
    /**
     * @dev This funcion allows the contract owner to add more locked distribution tokens, along
     *      with the associated "unlock schedule". These locked tokens immediately begin unlocking
     *      linearly over the duraction of durationSec timeframe.
     * @param amount Number of distribution tokens to lock. These are transferred from the caller.
     * @param durationSec Length of time to linear unlock the tokens.
     */
<span class="fstat-no" title="function not covered" >    function lockTokens(uint256 amount, uint256 durationSec) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(unlockSchedules.length &lt; _maxUnlockSchedules,</span>
            'DittoStaking: reached maximum unlock schedules');
&nbsp;
        // Update lockedTokens amount before using it in computations after.
<span class="cstat-no" title="statement not covered" >        updateAccounting()</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 lockedTokens = totalLocked();</span>
<span class="cstat-no" title="statement not covered" >        uint256 mintedLockedShares = (lockedTokens &gt; 0)</span>
            ? totalLockedShares.mul(amount).div(lockedTokens)
            : amount.mul(_initialSharesPerToken);
&nbsp;
<span class="cstat-no" title="statement not covered" >        UnlockSchedule memory schedule;</span>
<span class="cstat-no" title="statement not covered" >        schedule.initialLockedShares = mintedLockedShares</span>;
<span class="cstat-no" title="statement not covered" >        schedule.lastUnlockTimestampSec = now</span>;
<span class="cstat-no" title="statement not covered" >        schedule.endAtSec = now.add(durationSec)</span>;
<span class="cstat-no" title="statement not covered" >        schedule.durationSec = durationSec</span>;
<span class="cstat-no" title="statement not covered" >        unlockSchedules.push(schedule)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        totalLockedShares = totalLockedShares.add(mintedLockedShares)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        require(_lockedPool.token().transferFrom(msg.sender, address(_lockedPool), amount),</span>
            'DittoStaking: transfer into locked pool failed');
<span class="cstat-no" title="statement not covered" >        emit TokensLocked(amount, durationSec, totalLocked());</span>
    }
&nbsp;
    /**
     * @dev Moves distribution tokens from the locked pool to the unlocked pool, according to the
     *      previously defined unlock schedules. Publicly callable.
     * @return Number of newly unlocked distribution tokens.
     */
<span class="fstat-no" title="function not covered" >    function unlockTokens() public returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 unlockedTokens = 0;</span>
<span class="cstat-no" title="statement not covered" >        uint256 lockedTokens = totalLocked();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (totalLockedShares == 0) {</span>
<span class="cstat-no" title="statement not covered" >            unlockedTokens = lockedTokens</span>;
        } else {
<span class="cstat-no" title="statement not covered" >            uint256 unlockedShares = 0;</span>
<span class="cstat-no" title="statement not covered" >            for (uint256 s = 0; s &lt; unlockSchedules.length; s++) {</span>
<span class="cstat-no" title="statement not covered" >                unlockedShares = unlockedShares.add(unlockScheduleShares(s))</span>;
            }
<span class="cstat-no" title="statement not covered" >            unlockedTokens = unlockedShares.mul(lockedTokens).div(totalLockedShares)</span>;
<span class="cstat-no" title="statement not covered" >            totalLockedShares = totalLockedShares.sub(unlockedShares)</span>;
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (unlockedTokens &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >            require(_lockedPool.transfer(address(_unlockedPool), unlockedTokens),</span>
                'DittoStaking: transfer out of locked pool failed');
<span class="cstat-no" title="statement not covered" >            emit TokensUnlocked(unlockedTokens, totalLocked());</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return unlockedTokens;</span>
    }
&nbsp;
    /**
     * @dev Returns the number of unlockable shares from a given schedule. The returned value
     *      depends on the time since the last unlock. This function updates schedule accounting,
     *      but does not actually transfer any tokens.
     * @param s Index of the unlock schedule.
     * @return The number of unlocked shares.
     */
<span class="fstat-no" title="function not covered" >    function unlockScheduleShares(uint256 s) private returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        UnlockSchedule storage schedule = unlockSchedules[s];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(schedule.unlockedShares &gt;= schedule.initialLockedShares) {</span>
<span class="cstat-no" title="statement not covered" >            return 0;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 sharesToUnlock = 0;</span>
        // Special case to handle any leftover dust from integer division
<span class="cstat-no" title="statement not covered" >        if (now &gt;= schedule.endAtSec) {</span>
<span class="cstat-no" title="statement not covered" >            sharesToUnlock = (schedule.initialLockedShares.sub(schedule.unlockedShares))</span>;
<span class="cstat-no" title="statement not covered" >            schedule.lastUnlockTimestampSec = schedule.endAtSec</span>;
        } else {
<span class="cstat-no" title="statement not covered" >            sharesToUnlock = now.sub(schedule.lastUnlockTimestampSec)</span>
                .mul(schedule.initialLockedShares)
                .div(schedule.durationSec);
<span class="cstat-no" title="statement not covered" >            schedule.lastUnlockTimestampSec = now</span>;
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        schedule.unlockedShares = schedule.unlockedShares.add(sharesToUnlock)</span>;
<span class="cstat-no" title="statement not covered" >        return sharesToUnlock;</span>
    }
&nbsp;
    /**
     * @dev Lets the owner rescue funds air-dropped to the staking pool.
     * @param tokenToRescue Address of the token to be rescued.
     * @param to Address to which the rescued funds are to be sent.
     * @param amount Amount of tokens to be rescued.
     * @return Transfer success.
     */
<span class="fstat-no" title="function not covered" >    function rescueFundsFromStakingPool(address tokenToRescue, address to, uint256 amount)</span>
        public onlyOwner returns (bool) {
&nbsp;
<span class="cstat-no" title="statement not covered" >        return _stakingPool.rescueFunds(tokenToRescue, to, amount);</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Dec 14 2020 22:10:28 GMT-0500 (Eastern Standard Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
